<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Foraging Mouse Example | Bonsai.ML </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Foraging Mouse Example | Bonsai.ML ">
      
      
      <link rel="icon" href="../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../docs/toc.html">
      
      <meta name="docfx:rel" content="../../../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/bonsai-rx/machinelearning/blob/main/examples/LinearDynamicalSystems/Kinematics/ForagingMouse/README.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../logo.svg" alt="Bonsai - ML">
            Bonsai - ML
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="foraging-mouse-example">Foraging Mouse Example</h1>

<p>The code for this repo can be found <a href="https://github.com/bonsai-rx/machinelearning-examples/tree/main/examples/LinearDynamicalSystems/Kinematics/ForagingMouse">here</a>.</p>
<p>In the following example, you can find how the Kalman Filter can be used to infer the kinematics of a mouse behaving in a foraging arena.</p>
<h3 id="dependencies">Dependencies</h3>
<p>If you used the bootstrapping method, you dont have to worry about the package dependencies, as these should be already installed. However, if creating a new environment or integrating into an existing one, you will need to install the following packages:</p>
<ul>
<li>Bonsai - Core v2.8.1</li>
<li>Bonsai - Design v2.8.0</li>
<li>Bonsai - Editor v2.8.0</li>
<li>Bonsai - ML v0.1.0</li>
<li>Bonsai - ML LinearDynamicalSystems v0.1.0</li>
<li>Bonsai - ML Visualizers v0.1.0</li>
<li>Bonsai - Scripting v2.8.0</li>
<li>Bonsai - Scripting Python v0.2.0</li>
<li>Bonsai - Vision v2.8.1</li>
<li>Bonsai - Vision Design v2.8.1</li>
</ul>
<h3 id="dataset">Dataset</h3>
<p>The video for this example was generously provided by the Sainsbury Wellcome Centre Foraging Behaviour Working Group. (2023). Aeon: An open-source platform to study the neural basis of ethological behaviours over naturalistic timescales, <a href="https://doi.org/10.5281/zenodo.8413142">https://doi.org/10.5281/zenodo.8413142</a></p>
<p>You can download the <code>ForagingMouseExampleVid.avi</code> video file here: <a href="https://doi.org/10.5281/zenodo.10629221">https://doi.org/10.5281/zenodo.10629221</a>. The workflow expects the video to be placed into the <code>datasets</code> folder but if you prefer to keep the video elsewhere, simply change the <code>Filename</code> property of the <code>MouseTracking</code> group node to point to the correct location.</p>
<h3 id="workflow">Workflow</h3>
<p>Below is the workflow for inferring kinematics of a mouse during a foraging task.</p>
<div class="workflow"><p><img src="ForagingMouse.bonsai" alt="Kinematics - Mouse Foraging Behaviour"></p>
</div>
<p>In this example, a Kalman Filter is used to infer the position, velocity, and acceleration of the freely moving mouse. The frames per second of the video is 50 Hz, so we set the <code>Fps</code> property of the <code>CreateKFModel</code> node to 50. The workflow performs centroid tracking inside of the <code>MouseTracking</code> group node, which uses a standard image analysis pipeline to extract the <code>Centroid</code> of the animal. The <code>Centroid</code> data is then converted into a type of <code>Observation2D</code> that the model then uses to perform inference using the  <code>PerformInference</code> node.</p>
<p>Since the tracking pipeline takes some time to initialize, we wait to create the kalman filter using the <code>SubscribeWhen</code> node only once <code>TrackingStarted</code> has produced a value, which is conditioned on centroid != NaN.</p>
<p>To visualize the inferred position, velocity, and acceleration kinematics, the <code>MouseKinematicsVisualizer</code> node positioned at the bottom of the workflow can be openned while the workflow is running. On the left, you should see the inferred position, velocity and acceleration (top to bottom), with the ability to select which state component (X or Y) you want to visualize from the dropdown menu on the top right corner of the graph. Both the mean (dark blue) and variance (light blue shading) of the inferred state component are visualized. On the right, you should see the video playing with the tracking data (blue) and inferred position (red) overlaid.</p>
<p>The workflow should look like this:</p>
<p><img src="ForagingMouse.gif" alt="Foraging Mouse"></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/bonsai-rx/machinelearning/blob/main/examples/LinearDynamicalSystems/Kinematics/ForagingMouse/README.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          &copy; 2024 Bonsai Foundation CIC and Contributors. Made with <a href="https://dotnet.github.io/docfx">docfx</a>
        </div>
      </div>
    </footer>
  </body>
</html>
